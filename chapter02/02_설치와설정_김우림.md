#  설치와 설정

## 2.1 MySQL 서버 설치

### 2.1.1 버전과 에디션(엔터프라이즈와 커뮤니티) 선택

* 새로운 메이저 버전으로 업그레이드 하는 경우라면 최소 패치 버전이 15 ~ 20번 이상 릴리스된 버전을 선택하는 것이 안정적인 서비스에 도움
* 갓 출시된 메이저 버전은 갓 출시된 상태에서는 치명적이거나 보완하는 데 많은 시간이 걸릴 만한 버그가 발생할 수 있으므로 위험할 수 있음
* MySQL 서버의 상용화 전략은 엔터프라이즈 에디션과 커뮤니티 에디션 모두 동일, 특정 부가 기능들만 상용 버전인 엔터프라이즈 에디션에 포함, 이런 상용화 방식을 오픈 코어 모델(Open Core Model)이라고 함

### 2.1.2 MySQL 설치

#### 2.1.2.1 리눅스 서버의 Yum 인스톨러 설치

* 리눅스 서버에서 Yum 리포지토리 등록 
* Yum 인스톨러 명령 이용해 버전별로 설치 가능한 MySQL 소프트웨어 목록 확인

> 참고 : sudo 명령은 yum명령을 root 권한으로 실행하게 해준다. MySQL 서버를 설치하는 과정에서 리눅스 서버의 관리자만 접근할 수 있는 디렉터리에 파일들을 복사하기 때문에 반드시 root 권한이 필요하다. 그래서 만약 현재 사용자가 root가 아니라면 sudo 명령을 yum 명령과 함께 사용해야 한다.

* 설치 하더라고 MySQL서버를 바로 시작할 수 있는 준비 X

#### 2.1.2.2 리눅스 서버에서 Yum 인스톨러 없이 RPM 파일로 설치

* 설치파일 직접 다운로드

#### 2.1.2.3 macOS용 DMG 패키지 설치

* 설치가 완료되면 MySQL 서버 자동 실행
* MySQL 서버가 설치된 디렉터리는 /usr/local/mysql 이며, 하위의 각 디렉터리 정보는 다음과 같다.
  * bin : MySQL 서버와 클라이언트 프로그램, 유틸리티를 위한 디렉터리
  * data : 로그 파일과 데이터 파일들이 저장되는 디렉터리
  * include : C/C++ 헤더 파일들이 저장된 디렉터리
  * lib : 라이브러리 파일들이 저장된 디렉터리
  * share : 다양한 지원 파일들이 저장돼 있으며, 에러 메시지나 샘플 설정 파일(my.cnf)이 있는 디렉터리

#### 2.1.2.4 윈도우 MSI 인스톨러 설치

* MySQL 서버의 프로그램과 설정 파일(my.ini)의 위치는 윈도우 서비스 화면에서 MySQL80 서비스의 등록 정보를 통해 확인할 수 있다.
* 서버 디렉터리 구조
  * bin : MySQL 서버와 클라이언트 프로그램, 유틸리티를 위한 디렉터리
  * include : C/C++ 헤더 파일들이 저장된 디렉터리
  * lib : 라이브러리 파일들이 저장된 디렉터리
  * share : 다양한 지원 파일들이 저장돼 있으며, 에러 메시지나 샘플 설정 파일(my.ini)이 있는 디렉터리

## 2.2 MySQL 서버의 시작과 종료

### 2.2.1 설정 파일 및 데이터 파일 준비

* 리눅스 서버에서 Yum 인스톨러나 RPM 을 이용해 MySQL 서버를 설치하면 MySQL 서버에 필요한 프로그램들과 디렉터리들은 일부 준비되지만 트랙잭션 로그 파일과 시스템 테이블이 준비되지 않았기 때문에 아직 MySQL 서버를 시작할 수 없다.
* MySQL 서버를 실행하는 데 필요한 초기 데이터 파일(시스템 테이블이 저장되는 데이터 파일)과 트랜잭션 로그(리두 로그) 파일을 생성하자.

### 2.2.2 시작과 종료 

* MySQL 서버에서는 실재 트랜잭션이 정상적으로 커밋돼도 데이터 파일에 변경된 내용이 기록되지 않고 로그파일(리두 로그)에만 기록돼 있을 수 있음
* MySQL 서버가 종료될 때 모든 커밋된 내용을 데이터 파일에 기록하고 종료하게 할 수 있다. 클린 셧다운 이라고 표현.
* 클린 셧다운으로 종료되면 다시 MySQL 서버가 기동될 때 별도의 트랜잭션 복구 과정을 진행하지 않기 때문에 빠르게 시작할 수 있다. 

> 주의 : MySQL 서버의 시작 시간이 오래 걸린다면 MySQL 서버가 서버 풀의 내용을 복구하고 있는지 확인 해보는 것이 좋다.

### 2.2.3 서버 연결 테스트

* MySQL 서버에 접속하려면 MySQL 서버 프로그램과 함께 설치된 MySQL 기본 클라이언트 프로그램인 mysql 을 실행

```bash
linux> mysql -uroot -p --host=localhost --socket=/tmp/mysql.sock
linux> mysql -uroot -p --host=127.0.0.1 --port=3306
linux> mysql -uroot -p 
```

* 첫번째 예제는 MySQL 소켓 파일을 이용해 접속하는 예제
* 두번째 예제는 TCP/IP 를 통해 127.0.0.1(로컬 호스트)로 접속하는 예제
  * 이 경우에는 포트를 명시하는 것이 일반적
  * 로컬 서버에 설치된 MySQL 이 아니라 원격 호스트에 있는 MySQL 서버에 접속할 때는 반드시 두 번째 방법 사용

> MySQL 서버에 접속할 때 호스트를 localhost로 명시하는 것과 127.0.0.1로 명시하는 것의 각각 의미가 다르다. --host=localhost 옵션을 사용하면 MySQL 클라이언트 프로그람은 항상 소켓 파일을 통해 MySQL 서버에 접속하게 되는데, 이는 'Unix domain socket'을 이용하는 방식으로 TCP/IP를 통한 통신이 아니라 유닉스의 프로세스 간 통신(IPC)의 일종이다. 하지만 127.0.0.1 을 사용하는 경우에는 자기 서버를 가리키는 루프백 IP이기는 하지만 TCP/IP 통신 방식을 사용하는 것이다.

* 세 번째 방식은 별도로 호스트 주소와 포트를 명시하지 않는다. 이 경우에는 기본값으로 호스트는 localhost가 되며 소켓 파일을 사용, 소켓 파일의 위치는 MySQL 서버의 설정 파일에서 읽어서 사용.
* MySQL 서버에 직접 로그인 하지 않고 원격 서버에서 MySQL 서버의 접속 가능 여부만 확인하는 방법

```bash
linux> telnet 10.2.40.61 3306
linux> nc 10.2.40.61 3306
```

## 2.3 MySQL 서버 업그레이드

* MySQL 서버 업그레이드 방법

1. 인플레이스 업그레이드 : 서버의 데이터 파일을 그대로 두고 업그레이드 하는 방법
2. 논리적 업그레이드 : mysqldump 도구 등을 이용해 MySQL 서버의 데이터를 SQL 문장이나 텍스트 파일로 덤프한 후, 새로 업그레이드된 버전의 MySQL 서버에서 덤프된 데이터를 적재하는 방법

## 2.4 서버 설정

* MySQL 서버는 단 하나의 설정 파일 사용
* 유닉스 계열 - my.cnf, 윈도우 계열 - my.ini
* 서버는 시작될 때만 이 파일 참조
* 실제 서버는 단 하나의 설정 파일만 사용하지만 설정 파일이 위치한 디렉터리는 여러 곳일 수 있다.

### 2.4.1 설정 파일의 구성

* MySQL 설정 파일은 하나의 my.cnf 나 my.ini 파일에 여러 개의 설정 그룹을 담을 수 있으며, 대체로 실행 프로그램 이름을 그룹명으로 사용한다.  

### 2.4.2 MySQL 시스템 변수의 특징

* MySQL 서버는 기동하면서 설정 파일의 내용을 읽어 메모리나 작동 방식을 초기화하고, 접속된 사용자를 제어하기 위해 이러한 값을 별도로 저장해 둔다. 
* MySQL 서버에서는 이렇게 저장된 값을 시스템 변수라고 한다.
* 시스템 변수(설정)값이 어떻게 MySQL 서버와 클라이언트에 영향을 미치는지 판단하려면 각 변수가 글로벌 변수인지 세션 변수인지 구분할 수 있어야 한다.

### 2.4.3 글로벌 변수와 세션 변수

* 글로벌 범위의 시스템 변수는 하나의 MySQL 서버 인스턴스에서 전체적으로 영향을 미치는 시스템 변수를 의미하며, 주로 MySQL 서버 자체에 관련된 설정일 때가 많다.
* 세션 범위의 시스템 변수는 MySQL 클라이언트가 MySQL 서버에 접속할 때 기본으로 부여하는 옵션의 기본값을 제어하는 데 사용된다. 별도로 값을 변경하지 않으면 그대로 값이 유지되지만, 클라이언트의 필요에 따라 개별 커넥션 단위로 다른 값으로 변경할 수 있다. 여기서 기본값은 글로벌 시스템 변수이며, 각 클라이언트가 가지는 값이 세션 시스템 변수이다. 
* 세션 범위의 시스템 변수 가운데 MySQL 서버의 설정 파일에 명시에 초기화 할 수 있는 변수는 대부분 범위가 Both

### 2.4.4 정적 변수와 동적 변수

* MySQL 서버의 시스템 변수는 MySQL 서버가 기동 중인 상태에서 변경 가능한지에 따라 동적 변수와 정적 변수로 구분된다. 
* MySQL 서버의 시스템 변수는 디스크에 저장돼 있는 파일 (my.cnf 또는 my.ini)를 변경하는 경우와 이미 기동 중인 MySQL 서버의 메모리에 있는 MySQL 서버의 시스템 변수를 변경하는 경우로 구분
* 디스크에 저장된 설정 파일의 내용은 변경하더라도 MySQL 서버가 재시작하기 전에는 적용x
* SET 명령으로 시스템 변수값 변경 가능, 하지만 설정파일에 반영되지는 x, 현재 기동 중인 MySQL 인스턴스에서만 유효
* MySQL 서버가 재시작하면 다시 설정 파일의 내용으로 초기화되기 때문에 설정을 영구히 적용하려면 my.cnf 파일도 반드시 변경
* 변경하고자 하는 값이 동적 변수라면 SET 명령으로 간단히 변수값 설정 가능, 서버 재시작 하지 않아도 됨
* 동적으로 시스템 변수값을 변경하는 경우 SET 명령으로 시스템 변수를 변경하면 my.cnf 설정 파일에는 변경 내용 기록 x
* MySQL의 시스템 변수 가운데 동적인 변수만 SET 명령을 이용해 변경 가능

### 2.4.5 SET PERSIST

* 시스템 변수는 동적 변수와 정적 변수로 구분
* 동적 변수의 경우 MySQL 서버에서 SET GLOBAL 명령으로 변경하면 즉시 MySQL 서버에 반영
* 동적 변수를 변경한 후 설정 파일에도 적용해야 하는데, 잊어버리는 경우 생김
* 이러한 문제점 보완 위해 SET PERSISIT 명령 도입
* SET PERSIST 명령으로 시스템 변수 변경하면 서버는 변경된 값을 즉시 적용함과 동시에 별도의 설정 파일에 변경 내용을 추가로 기록
* 즉, MySQL 서버 설정 파일에 변경 내용을 수동으로 기록하지 않아도 자동으로 영구 변경
* 세션 변수에는 적용x
* 정적인 변수의 값을 영구적으로 변경하고자 할 때는 SET PERSIST_ONLY
* SET PERSIST나 SET PERSIST_ONLY 로 시스템 변수를 변경하면 JSON 포맷의 mysqld-auto.cnf 파일 생성됨

### 2.4.6 my.cnf 파일



















































































































































































































