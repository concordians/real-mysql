10. 1 통계 정보

- 통계정보 → 실행 계획에 가장 큰 영향
- MySQL 8.0 버전부터 인덱스 되지 않은 칼럼들에 대해서도 데이터 분포도를 수집해서 저장하는 히스토그램 정보 도입
- 10.1.1 테이블 및 인덱스 통계 정보
  - 10.1.1.1 MySQL 서버의 통계정보
    - MySQL 5.5 버전까지는 테이블 통계 정보가 메모리에서만 관리, SHOW INDEX 로만 인덱스 칼럼의 분포도 확인
      → MySQL 서버가 재시작 되면 수집된 통계정보 모두 사라짐
    - 5.6 버전 부터 mysql 데이터베이스의 테이블로 관리할 수 있음 → 기존의 통계정보를 계속 유지 가능
    - STAT_PERSISTENT=1(ON, 디폴트) : 데이터 통계정보를 mysql 데이터베이스에innodb_index_stat 와 innodb_table_stats 테이블에 저장함
    - 통계정보 각 칼럼 : 인덱스가 가진 유니크 값의 개수, 인덱스의 리프노드페이지 개수, 인덱스 트리의 전체페이스 개수 등
    - 자동 통계정보 갱신되는 이벤트 : 테이블 새로 오픈, 데이터 레코드 대량 변경 등
    - 통계 정보 자주 갱신될 경우 (인덱스 스캔대신 풀 테이블 스캔등) MySQL 서버가 잘못된 계획 세울 수 있음
    - STATS_AUTO_RECALC = 1 : 5.5 버전 이전처럼 통계정보 자동 수집  
    - STATS_AUTO_RECALC = 0 : ANALYZE TABLE 명령어 사용시에만 통계정보 수집
    - innodb_stats_transient_sample_pages : 디폴트값 8, 자동으로 통계수집될때 8개 페이지만 임의로 샘플링
    - innodb_stats_persistent_sample_pages : 디폴트값 20, ANALYZE TABLE 명령어 실행되면 임의로 20페이지만 샘플링 하여 분석하고 통계정보 테이블에 저장하고 활용

10.1.2 히스토그램

- 옵티마이저가 실행 계획을 수립할 때 실제 인덱스의 일부 페이지를 랜덤으로 가져와 참조하는 방식

-  ANALYZE TABLE ... UPDATE HISTOGRAM

- 히스토그램 종류

  - Singleton(싱글톤 히스토그램) : 칼럼값 개별로 레코드 건수확인하는 히스토그램
  - Equi-Height(높이 균형 히스토그램) : 컬럽값의 범위를 균등한 개수로 구분해서 관리하는 히스토그램

- HISTOGRAM 칼럼이 가진 필드

  - sampling-rate : 히스토그램 정보 수집 위해 스캔한 페이지 비율을 저장한다.
  -  ex) 샘플링 비율 0.35 -> 데이터 페이지의 35% 스캔해서 정보 수집
  - histogram-type: 히스토그램 종류 지정
  - numbet-of buckets-specified : 히스토그램생성 시 설정했던 버킷의 개수를 저장(디폴트 100개)

  
